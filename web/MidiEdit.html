<html>
<script src="../local/jquery.js"></script>
<link rel="stylesheet" type="text/css" href="../local/MidiEdit.css">
<script src="../github/JZZ-master/javascript/JZZ.js"></script>
<script src="../github/JZZ-synth-Tiny-master/javascript/JZZ.synth.Tiny.js"></script>
<script>
  JZZ.synth.Tiny.register('Synth');
  var port = JZZ().openMidiOut().or(function() {
    alert('Cannot open MIDI port!');
  });

  function play(id) {

    port.send([0x90, id, 100]);

  }

  function stop(id) {
    port.send([0x80, id, 0]);
  }
  var note = new Array("B", "A#", "A", "G#", "G", "F#", "F", "E", "D#", "D", "C#", "C");

  function createTable() {

    var table = document.getElementById("mytable");
    var notetable = document.getElementById("mynote");
    var row = table.rows.length;
    var i, color, count = 6;

    for (i = 0; i < 48; i++) {

      if ((i % 12 == 1) || (i % 12 == 3) || (i % 12 == 5) || (i % 12 == 8) || (i % 12 == 10))
        color = "black";
      else
        color = "white";

      notetable.innerHTML += "<tr  id=" + (95 - i) + " onmousedown='play(this.id)'; onmouseup='stop(this.id)';><th class='" + color + "'>" + note[i % 12] + count + "</th></tr>";
      table.innerHTML += "<tr class='tt' name='" + (95 - i) + "'><td></td><td></td><td></td><td></td><td></td><td>" +
        "</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>";

      if (i % 12 == 0) count--;
    }
    start();
  }

  function start() {
    var table = document.getElementById("mytable");
    var col = table.rows[0].cells.length;

    $('.tt td').on('mousedown', function() {
      play($(this).parent().attr("name"));
      if (col - $(this).index() <= 4) {
        add();
        col = table.rows[0].cells.length;
      }
      if ($(this).attr('class') == "highlighted")
        $(this).removeClass("highlighted");
      else
        $(this).addClass("highlighted");
      return false;

    })
    $('.tt td').on('mouseup', function() {
      stop($(this).parent().attr("name"));
    })
  }

  function add() {
    $(".tt").append("<td></td><td></td><td></td><td></td>");
    $('.tt td').off('mousedown');
    start();
  }
</script>
<script src="../local/bar.js"></script>

<body onload="createTable()">

  <div style="overflow-x:hidden;overflow-y:auto;position:relative; height:84%;top:5%;">
    <table>
      <td style="width: 10%">
        <table class="notec" style="width:100%;" id="mynote">
        </table>
      </td>

      <td style="position:absolute; attachment:fixed; left:10%; width: 90%">
        <div style="overflow-y:hidden;width:100%;">
          <table class="notec" style=" width:100%;height: 50%; z-index:1;" id="mytable">
          </table>
        </div>
      </td>
    </table>
  </div>

</body>

</html>
